import { React } from 'react'
import { Link, useLocation } from 'react-router-dom'

import { getWishById, getWishlistById } from 'getters'
import { Icon, WishpageDescriptionPointer } from 'components/Icon'
import { User } from 'components/User'
import { Button } from 'components/Button'

export const WishPage = () => {
    const loca = useLocation().pathname;
    const currentWishId = loca.split('/').at(-1)
    console.log('current wish id is: ', currentWishId)
    const w = getWishById(currentWishId);
    console.log('current wish is: ', w)
    const currency = w.currency==='rouble' ? ' ₽'
                   : w.currency==='yuan'   ? ' Ұ'
                   : w.currency==='usd'    ? ' $'
                   : w.currency==='euro'   ? ' €'
                   : '';
    
    const OuterLink = () => {
        if(!w.external) return null;
        const url = new URL(w.external)
        return (
            <a href={ w.external }>
                { url.host }
                <Icon name='outerLink'/>
            </a>
        );
    }

    const WishlistOccurrences = () => {
        if(!w.wishlistIds.length) return (
            <div className='info-wishlists'>
                <span className='label'>Желание не включено в вишлист</span>
            </div>
        );

        console.log('w.wishlistIds is: ', w.wishlistIds)

        const labelText = (w.wishlistIds.length == 1)
            ? 'Включено в вишлист'
            : 'Включено в вишлисты:'

        const mappedLinks = w.wishlistIds.map( (id, index) => {
            const wl = getWishlistById(id);
            const comma = index ? (<span> , </span>) : null
            return (
                <div>
                    { comma }
                    <Link
                        className='basic-link'
                        to={`/${ loca.split('/')[1] }/lists/${ wl.id }`}
                    >
                        { wl.title }
                    </Link>
                </div>
            );
        });

        return (
            <div className='info-wishlists'>
                <span className='label'>{ labelText }</span>
                <div className='links'>{ mappedLinks }</div>
            </div>
        );
    }

    const UserInfo = () => {
        return (
            <div className='user-info'>
                <span className='label'>Желает</span>
                <User picSize='44' userName={ w.author }/>
            </div>
        );
    }

    const Description = () => {
        if(!w.description) return null;
        return (
            <div className='description'>
                <WishpageDescriptionPointer/>
                <div className='container'>{ w.description }</div>
            </div>
        )
    }

    const PrimaryButton = () => {
        const isMyWish = loca.split('/')[1] === 'my-wishes'
            ? true : false

        const content = (w.state === 'manifested' && isMyWish)
            ? {
                icon: 'ok',
                text: 'Отметить исполненным',
                handleClick() {console.log('жмяк')},
            }
            : (w.state === 'manifested' && !isMyWish)
            ? {
                icon: 'present',
                text: 'Исполнить желание',
                handleClick() {console.log('жмяк')},
            }
            : (w.state === 'reserved')
            ? {
                icon: 'lock',
                text: 'Исполнить желание',                
                isDisabled: true,
            }
            : (w.state === 'completed')
            ? {
                icon: 'ok',
                text: 'Желание исполнено',
                isDisabled: true,
            }
            : undefined

        if(!content) return null;

        return (
            <Button
                type='primary'
                leftIcon={ content.icon }
                text={ content.text }
                isDisabled={ !!content.isDisabled }
                handleClick={ content.handleClick }
            />
        );



    }

    return (
        <div className='wish-page'>
            <div className='img-block'>
                <img src={ w.image }></img>
            </div>
            <div className='content-block'>
                <div className='header'>
                    <span className='title'>{ w.title }</span>
                    <OuterLink/>
                </div>
                <div className='info'>
                    <WishlistOccurrences/>
                    <UserInfo/>
                    <Description/>
                </div>
                <div className='actions'>
                    <span className='price'>{ w.price + currency}</span>
                    <PrimaryButton/>
                </div>
            </div>
        </div>
    );
}