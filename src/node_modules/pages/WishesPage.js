import React, { useLayoutEffect } from 'react'
import { useLocation, useNavigate, useParams } from 'react-router'
import { useSelector, useDispatch } from 'react-redux'

import { MCTLayout } from 'containers/MCTLayout'
import { putItems } from 'store/mCTLayoutSlice'
import { WishCard } from 'containers/WishCard'

export const WishesPage = () => {
    let navigate = useNavigate();
    const dispatch = useDispatch();
    const loca = useLocation().pathname;
    const firstLvl = loca.split('/').at(1);
    let { tabName } = useParams();

    const allWishes = (firstLvl === 'my-wishes')
                    ? useSelector(state => state.wishes.ofCurrentUser)
                    : useSelector(state => state.wishes.ofOtherUsers);

    const wishes = (tabName === 'all')
                 ? allWishes
                 : (tabName === 'actual' || tabName === 'reserved')
                 ? allWishes.filter(wish => wish.state === 'actual' || wish.state === 'reserved')
                 : (tabName === 'completed')
                 ? allWishes.filter(wish => wish.state === tabName)
                 : null

    if(wishes === null) {
        navigate('/page-not-found', { replace: true });
    } else {
        useLayoutEffect(() => {
            dispatch(putItems( wishes ));
        })
    }

    // return <div/>
    return <MCTLayout Component={WishCard}/>
}