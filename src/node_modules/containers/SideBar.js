import React, { useEffect } from 'react'
import { Link, useMatch } from 'react-router-dom'
import { Outlet } from 'react-router'
import { useSelector, useDispatch } from 'react-redux'

import { IconButton } from 'components/IconButton'
import { Highlighter } from 'components/Highlighter'
import { setHighlighterCoordsInSideBar } from 'store/highlighterSlice'

export const SideBar = () => {
    const wishLists = useSelector(state => state.wishLists.all)

    const dispatch = useDispatch();
    
    const Divider = () => ( <div className='divider'></div> )
    const Header = ({ children, plusFunc }) => {
        return (
            <div className='side-header'>
                <span>{children}</span>
                <IconButton icon='plus' func={plusFunc} size='55'/>
            </div>
        )
    }
    const Option = ({ children, to }) => {
        const match = useMatch(to);
        useEffect(() => {
            dispatch(setHighlighterCoordsInSideBar())
        })

        return (
            <Link to={ to } className={ match ? 'side-nav active' : 'side-nav'}>
                { children }
            </Link>
        )
    }

    return (
        <div className='app-body'>
            <div className='sidebar'>
                <Highlighter location='sidebar'/>
                <Header>Желания</Header>
                <Option to='/my-wishes/actual'>Актуальные</Option>
                <Option to='/my-wishes/done'>Исполненные</Option>
                <Option to='/my-wishes/all'>Все</Option>
                <Divider/>
                <Header>Списки</Header>
                { Object.values(wishLists).map( (wishList, index) => 
                    <Option key={index} to={'/wishlists/my/' + wishList.id}>{wishList.title}</Option>
                )}
            </div>
            <div className='work-space'>
                <Outlet/>
            </div>
        </div>
    );
}