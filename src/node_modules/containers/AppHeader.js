import React, { useEffect } from 'react'
import { Link, useParams, useMatch } from 'react-router-dom'
import { Outlet } from 'react-router'
import { useSelector, useDispatch } from 'react-redux'

import { LogoIcon } from 'components/Icon'
import { Highlighter } from 'components/Highlighter'
import { setHighlighterCoordsInAppHeader } from 'store/highlighterSlice'

export const AppHeader = () => {
    const wishLists = useSelector(state => state.wishLists.all)
    const { wishListId } = useParams();
    const currentWishList = wishLists[ wishListId ];

    const dispatch = useDispatch();
    
    const Slash = () => <div className='header-nav'>/</div>
    const Tab = ({ children, to }) => {
        const match = useMatch({ path: to.substring(0, 11), end: false });

        useEffect(() => {
            dispatch(setHighlighterCoordsInAppHeader())
        })

        return (
            <Link to={ to } className={ match ? 'header-nav active' : 'header-nav' } >
                { children }
            </Link>
        );
    }

    return (
        <div className='app-layout'>
            <div className='app-header'>
                <Highlighter location='app-header'/>
                <div className='logo'>
                    <Link to="/my-wishes/actual" className='logo-btn'>
                        <LogoIcon/>
                    </Link>
                </div>
                <div className='tab-group'>
                    <Tab to="/my-wishes/actual" >Мои желания</Tab>
                    { currentWishList && <div><Slash/><Tab to={"/wishlists/my/" + currentWishList.id} >{currentWishList.title}</Tab></div> }
                </div>
                <div className='tab-group'>
                    <Tab to="/my-invites/actual" >Мои пришлашения</Tab>
                    { false && <div><Slash/><Tab to="/wishlists/{ here must be userId }/" >День рождения</Tab></div> }
                </div>
            </div>
            
            <Outlet/>
            
        </div>
    );
}