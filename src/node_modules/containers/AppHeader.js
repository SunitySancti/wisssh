import React, { useEffect } from 'react'
import { Link, useLocation } from 'react-router-dom'
import { Outlet } from 'react-router'
import { useDispatch } from 'react-redux'

import { LogoIcon, LogoBack } from 'components/Icon'
import { Highlighter } from 'components/Highlighter'
import {
    setHighlighterCoordsInAppHeader,
    highlightSectionStart,
    highlightSectionFinish } from 'store/highlighterSlice'

export const AppHeader = () => {
    const loca = useLocation().pathname.split('/').at(1)
    const isMyWishes = loca === 'my-wishes'

    const dispatch = useDispatch();
    const clearTransitions = () => {
        document.querySelector('.goo-highlighters .highlighter').classList.remove('animated');
    }

    useEffect(() => {
        window.addEventListener('resize', () => dispatch(highlightSectionFinish()));
        return () => { window.removeEventListener('resize', () => dispatch(highlightSectionFinish())) }
    }, [])

    useEffect(() => {
        dispatch(highlightSectionStart());
        setTimeout(() => dispatch(highlightSectionFinish()), 300);
        setTimeout(clearTransitions, 600);
    }, [ loca ])
        
    return (
        <div className='app-layout'>
            <div className='app-header'>
                <div className='goo-highlighters'>
                    <Highlighter location='app-header'/>
                    <LogoBack/>
                </div>
                <div className='center-group'>
                    <Link
                        to='/my-wishes/items/actual'
                        className={ isMyWishes ? 'section my-wishes active' : 'section my-wishes' }
                    >
                        Мои желания
                    </Link>
                    <Link to="/my-wishes/items/actual" className='logo-btn'>
                        <LogoIcon/>
                    </Link>
                    <Link
                        to='/my-invites/items/reserved'
                        className={ isMyWishes ? 'section my-invites' : 'section my-invites active' }
                    >
                        Приглашения
                    </Link>
                </div>
            </div>
            
            <Outlet/>
            
        </div>
    );
}